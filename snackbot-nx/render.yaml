services:
  - type: web
    name: snackbot-api
    env: python
    region: oregon
    plan: free
    buildCommand: |
      # Install Node.js (Render Python images don't include it by default)
      curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && apt-get install -y nodejs
      # Build React app
      cd apps/snackbot-web && npm install && npm run build && cd ../..
      # Install Python dependencies
      pip install -r apps/snackbot-api/requirements.txt
    startCommand: cd apps/snackbot-api && gunicorn -w 4 -b 0.0.0.0:$PORT wsgi:app
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.7
      - key: PORT
        value: 10000
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_CHAT_MODEL
        value: gpt-4o-mini
      - key: OPENAI_EMBED_MODEL
        value: text-embedding-3-small
      - key: CHROMA_PERSIST_DIR
        value: ./data/chroma
      - key: GDOCS_PUBLISHED_URLS
        sync: false
      - key: ALLOWED_ORIGINS
        value: "*"
      - key: FLASK_DEBUG
        value: "0"
